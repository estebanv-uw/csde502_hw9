---
title: "CSDE 502: Assignment #9"
author: "[Esteban J. Valencia](mailto:estebanv@uw.edu)"
date: '`r format(Sys.time(), "%Y-%m-%d %H:%M")`'
header-includes:
- \usepackage{float} 
- \floatplacement{figure}{H}
output:
  bookdown::html_document2:
    theme: journal
    number_sections: TRUE
    self_contained: TRUE
    code_folding: hide
    toc: TRUE
    toc_float:
      collapsed: TRUE
      smooth_scroll: TRUE
urlcolor: blue

output: 
    bookdown::html_document2:
        theme: journal
        number_sections: true
        self_contained: true
        code_folding: hide
        toc: true
        toc_float:
            collapsed: true
            smooth_scroll: false
urlcolor: blue        
---
```{css, echo=FALSE}
#Step 0.0.1: Setting wide-wise scrolling
pre, code {white-space: pre !important; overflow-x: auto}

```

```{r setup, warning = FALSE, message = FALSE, results = "hide"}
#Step 0.0.2: Specifying chunk options
knitr::opts_chunk$set(echo = TRUE, 
                      message = FALSE, 
                      warning = FALSE, 
                      results = "hide",
                      width = 1000)

#Step 0.0.4: Setting additional options
options(repos = "https://mirror.las.iastate.edu/CRAN/",
        width = 1000)

#Step 0.0.5: Loading requisite packages from library
library(captioner)
library(dplyr)
library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)

#Step 0.0.6: Setting captions
fig.nums = captioner(prefix = "Figure")
tab.nums = captioner(prefix = "Table")
```

# Overview

This assignment is intended to give you more practice delving into the Add Health data set and in manipulating additional variables.

Using the full household roster (you'll need to go back to teh full raw data source) create the following variables for each respondents: (1) total number in household, (2) number of sisters, (3) number of brothers, (4) and total number of siblings.

Additionally, calculate the proportion of students living with two biological parents. 

Additionally, calculate the number of household members that are *NOT* the biological mother, biological father, full brother, or full sister.

## Loading Data

The requisite Add Health data are downloaded to a temporary directory and then unzipped, after which the temporary directory is closed and
```{r}
#Step 1.1.1: Downloading & opening Add Health zip-file from URL.

  ##Specifying URL
  f.url = "http://staff.washington.edu/phurvitz/csde502_winter_2021/data/21600-0001-Data.dta.zip"

  ##Setting temporary directory
  t.dir = Sys.getenv("TEMP")

  ##Setting path for zipfile
  z.file = file.path(t.dir, basename = "21600-0001-Data.dta.zip")
  
  ##Setting file in temporary folder
  f.data = tools::file_path_sans_ext(z.file)
  
  ##Check loop: does file exist?
  if(!file.exists(f.data)){
    
    ###If the file does not exist...
    if(!file.exists(z.file)){
      curl::curl_download(url = f.url, destfile = z.file)
    }
    
    ###If the file does exist...
    unzip(zipfile = z.file, exdir = t.dir)
  }
  
  ##Check loop: has the file been read? If not, read file...
  if(!exists("d.adh")) {
    d.adh = haven::read_dta(f.data)
  }
  
  ##Changing column names to lower case
  colnames(d.adh) %<>% str_to_lower()
```

# Total Number of Household Members

The Add Health data do not contain a variable indicating the total number of siblings in a household members. Instead, they list a series of variables detailing the relationship of each household member to the respondent. As such, to identify the total number of household members, we must parse through these variables. First, we subset the data to contain only those variables of relevance (in teh Add Health data, those variables all begin with the prefix "H1HR").

```{r}
#Step 2.0.1: Subsetting variables
s.df = d.adh %>% select(starts_with("h1hr"))
```

Next, a proxy data frame is generated from the series of variables which ask about HH members' gender, and the total number of HH members is counted based on responses.

```{r}
#Step 2.0.2: Generating proxy data frame
p.df = s.df %>% select(starts_with("h1hr2"))

#Step 2.0.3: Recoding values based on codebook
p.df[p.df == 1 | p.df == 2 | p.df == 3 | p.df == 6 | p.df == 8] = 1
p.df[p.df == 7] = 0

#Step 2.0.4: Counting total number of responses indicating n'th HH member is present
p.df %<>% mutate(hh_mtotal = rowSums(p.df) + 1)

#Step 2.0.5: Binding results to main data frame
s.df %<>% cbind(s.df, hh_mtotal = p.df$hh_mtotal)

```

A tabulation of the total number of HH members in each HH is furnished below, along with a histogram.

```{r}
#Step 2.0.6: Generating frequency tabulation

  ##Building table
  tab.x = data.frame(table(s.df$hh_mtotal))
  
  ##Renaming table columns
  names(tab.x) = c("Total number of HH members", "Frequency")
  
  ##Formatting table
  tab.z = kable(tab.x) %>% kable_styling(full_width = FALSE)
  
  ##Printing table


```

# Source Code Appendix

The source code for this document is included below.
```{r comment = ''}
cat(readLines(con = "estebanv_csde502_hw9.Rmd"), sep = "\n")
```

